<form class="sb" role="search" (ngSubmit)="submit()" autocomplete="off" [attr.aria-expanded]="advancedOpen">

  <!-- Ligne 1 : input + bouton Rechercher -->
  <div class="sb__inline">
    <shared-form-field [forId]="'sb-q'" [label]="'Recherche'">
      <shared-input id="sb-q" [placeholder]="placeholder" [(value)]="query"></shared-input>
    </shared-form-field>

    <shared-button type="submit" size="md" class="sb__submit">Rechercher</shared-button>
  </div>

  <!-- Ligne 2 : actions secondaires -->
  <div class="sb__tools">
    <shared-button *ngIf="showAdvanced" variant="outline" type="button" (click)="toggleAdvanced()">
      {{ advancedOpen ? 'Masquer les filtres' : 'Plus de filtres' }}
    </shared-button>

    <shared-button *ngIf="advancedOpen || hasAnyFilter" variant="outline" type="button" (click)="reset()">
      Réinitialiser
    </shared-button>
  </div>

  <!-- Ligne 3 : filtres (wrap 2 par ligne) -->
  <div class="sb__filters" *ngIf="advancedOpen">
    <ng-container *ngFor="let f of filters; index as i; trackBy: trackByKey">
      <shared-form-field [forId]="'sb-f' + i" [label]="f.label">
        <shared-select
          [id]="'sb-f' + i"
          [options]="f.type === 'boolean' ? booleanOptions() : (f.options || [])"
          [searchable]="f.type === 'select' ? (f['searchable'] ?? true) : false"
          [placeholder]="f['placeholder'] || (f.type === 'boolean' ? 'Oui / Non' : 'Sélectionner…')"
          [value]="getSelectValue(f)"
          (valueChange)="onFilterChange(f.key, f.type, $event)">
        </shared-select>
      </shared-form-field>
    </ng-container>
  </div>
</form>

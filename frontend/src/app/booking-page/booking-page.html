<shared-container>
  <shared-headline-bar
    [title]="'bookings.title' | t"
    [actionLabel]="'common.back' | t"
    [actionLink]="'/' + lang()">
  </shared-headline-bar>

  <ng-container *ngIf="vm$ | async as vm">
    <div class="state muted" *ngIf="vm.state === 'loading'">
      {{ 'common.loading' | t }}
    </div>

    <div class="state error" *ngIf="vm.state === 'error'">
      <shared-badge variant="danger" tone="soft">
        {{ vm.message || ('bookings.load_error' | t) }}
      </shared-badge>
    </div>

    <ng-container *ngIf="vm.state === 'ready'">
      <div class="empty" *ngIf="!vm.items.length">
        <shared-badge variant="muted" tone="outline">
          {{ 'bookings.empty' | t }}
        </shared-badge>
      </div>

      <div class="grid" *ngIf="vm.items.length">
        <shared-card *ngFor="let b of vm.items; trackBy: trackById" class="bk-card">
          <div header class="bk-head">
            <h3 class="h6 title">#{{ b.id }}</h3>
            <div class="badges">
              <shared-badge [variant]="badgeVariant(b)">
                {{ ('bookings.status.' + b.status) | t }}
              </shared-badge>
            </div>
          </div>

          <div class="bk-body">
            <div class="row">
              <span class="label">{{ 'bookings.when' | t }}</span>
              <span class="value">{{ dateLabel(b.confirmed_at!) }}</span>
            </div>
            <div class="row">
              <span class="label">ID {{ 'events.title' | t }}</span>
              <span class="value">#{{ b.event }}</span>
            </div>
          </div>

          <div footer class="bk-foot">
            <shared-button
              variant="outline"
              size="sm"
              type="button"
              (click)="openDetail(b)">
              {{ 'common.details' | t }}
            </shared-button>

            <shared-button *ngIf="b.status !=='CANCELLED'"
              variant="outline"
              size="sm"
              type="button"
              (click)="cancel(b.public_id)">
              {{ 'common.cancel' | t }}
            </shared-button>
          </div>
        </shared-card>
      </div>
    </ng-container>
  </ng-container>
</shared-container>

<app-booking-detail
  *ngIf="showDetail"
  [booking]="booking"
  [asModal]="true"
  (close)="showDetail = false">
</app-booking-detail>

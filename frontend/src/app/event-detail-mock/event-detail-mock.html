<shared-container>
  <shared-headline-bar
    [title]="event()?.title ?? ('events.detail.title' | t)"
    [actionLabel]="'common.back' | t"
    [actionLink]="actionHref">
  </shared-headline-bar>

  <div class="state error" *ngIf="!event()">
    <shared-badge variant="danger" tone="soft">{{ 'events.detail.not_found' | t }}</shared-badge>
    <a [routerLink]="backLink()" class="linky">{{ 'common.back' | t }}</a>
  </div>

  <shared-card *ngIf="event() as ev" class="event-card">
    <div media class="thumb" aria-hidden="true"></div>

    <div header class="ev-head">
      <h3 class="h5">{{ ev.title }}</h3>
      <div class="badges">
        <shared-badge variant="accent" tone="soft">{{ ev.language }}</shared-badge>
        <shared-badge variant="muted" tone="soft">{{ ev.city }}</shared-badge>
        <shared-badge variant="danger" tone="soft" *ngIf="ev.is_cancelled">
          {{ 'events.cancelled' | t }}
        </shared-badge>
      </div>
    </div>

    <div class="ev-body">
      <div class="row">
        <span class="label">{{ 'events.venue' | t }}</span>
        <span class="value">{{ ev.venue_name }}</span>
      </div>
      <div class="row">
        <span class="label">{{ 'events.address' | t }}</span>
        <span class="value">{{ ev.address }}</span>
      </div>
      <div class="row">
        <span class="label">{{ 'events.when' | t }}</span>
        <span class="value">{{ ev.datetime_start | date:'EEEE d MMM, HH:mm' }}</span>
      </div>
      <div class="row">
        <span class="label">{{ 'events.seats' | t }}</span>
        <span class="value">{{ ev.max_seats }}</span>
      </div>
      <div class="row">
        <span class="label">{{ 'events.price' | t }}</span>
        <span class="value">
          {{ ev.price_cents === 0 ? ('events.free' | t) : price(ev.price_cents) }}
        </span>
      </div>
    </div>

    <div footer class="ev-foot">
      <a [routerLink]="backLink()" class="linky">{{ 'common.back' | t }}</a>
      <shared-button type="button" [disabled]="ev.is_cancelled" (click)="openPopup()" *ngIf="!alreadyBooked()">
        {{ ev.is_cancelled ? ('events.cancelled' | t) : ('events.book' | t) }}
      </shared-button>
      <span class="booked-info">
    <shared-badge tone="soft" variant="accent" *ngIf="alreadyBooked()">{{ 'events.already_booked' | t }}</shared-badge>
  </span>
    </div>
  </shared-card>
</shared-container>

<app-confirm-purchase *ngIf="confirmPopup"
                      [titleKey]="'checkout.confirm.title'"
                      [messageKey]="'checkout.confirm.message'"
                      [buyKey]="'checkout.buy'"
                      [cancelKey]="'common.cancel'"
                      [priceCents]="1500"
                      [asModal]="true"
                      (cancel)="closeDialog()"
                      (buy)="performPurchase()">
</app-confirm-purchase>

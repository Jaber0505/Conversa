<form class="register-container" [formGroup]="form" (ngSubmit)="submit()">

    <!-- Barre de progression -->
    <div class="progress-bar">
        <div class="progress-step" [class.active]="step >= 1">1</div>
        <div class="progress-step" [class.active]="step >= 2">2</div>
        <div class="progress-step" [class.active]="step >= 3">3</div>
        <div class="progress-step" [class.active]="step >= 4">4</div>
    </div>

    <!-- Étape 1 -->
    <div *ngIf="step === 1" class="step">
        <label>
            {{ 'register.first_name' | t }}
            <input class="input" type="text" formControlName="first_name" />
            <div *ngIf="getErrorKey('first_name')" class="error-popup">
                {{ getErrorKey('first_name') | t }}
            </div>
        </label>

        <label>
            {{ 'register.last_name' | t }}
            <input class="input" type="text" formControlName="last_name" />
            <div *ngIf="getErrorKey('last_name')" class="error-popup">
                {{ getErrorKey('last_name') | t }}
            </div>
        </label>

        <label>
            {{ 'register.birth_date' | t }}
            <input class="input" type="date" formControlName="birth_date" />
            <div *ngIf="getErrorKey('birth_date')" class="error-popup">
                {{ getErrorKey('birth_date') | t }}
            </div>
        </label>
    </div>

    <!-- Étape 2 -->
    <div *ngIf="step === 2" class="step">
        <p>{{ 'register.bio_intro' | t:{ name: form.get('first_name')?.value } }}</p>
        <label>
            {{ 'register.bio' | t }}
            <textarea class="input" formControlName="bio" rows="4"></textarea>
            <div *ngIf="getErrorKey('bio')" class="error-popup">
                {{ getErrorKey('bio') | t:{ min: 20 } }}
            </div>
        </label>
    </div>

    <!-- Étape 3 -->
    <div *ngIf="step === 3" class="step">
        <label>
            {{ 'register.language_native' | t }}
            <input class="input" type="text" formControlName="language_native" />
            <div *ngIf="getErrorKey('language_native')" class="error-popup">
                {{ getErrorKey('language_native') | t }}
            </div>
        </label>

        <label>
            {{ 'register.languages_spoken' | t }}
            <input
                class="input"
                type="text"
                placeholder="{{ 'register.add_language' | t }}"
                (keydown.enter)="addSpokenFromInput($event); $event.preventDefault();" />
            <div *ngIf="languagesSpoken.invalid && languagesSpoken.touched" class="error-popup">
                {{ 'errors.languages_spoken_required' | t }}
            </div>
            <div class="chip" *ngFor="let lang of languagesSpoken.controls; let i = index">
                {{ lang.value }}
                <span class="dot" (click)="removeSpokenAt(i)"></span>
            </div>
        </label>

        <label>
            {{ 'register.languages_learning' | t }}
            <input
                class="input"
                type="text"
                placeholder="{{ 'register.add_language' | t }}"
                (keydown.enter)="addLearningFromInput($event); $event.preventDefault();" />
            <div *ngIf="languagesLearning.invalid && languagesLearning.touched" class="error-popup">
                {{ 'errors.languages_learning_required' | t }}
            </div>
            <div class="chip" *ngFor="let lang of languagesLearning.controls; let i = index">
                {{ lang.value }}
                <span class="dot" (click)="removeLearningAt(i)"></span>
            </div>
        </label>
    </div>

    <!-- Étape 4 -->
    <div *ngIf="step === 4" class="step">
        <label>
            {{ 'register.email' | t }}
            <input class="input" type="email" formControlName="email" />
            <div *ngIf="getErrorKey('email')" class="error-popup">
                {{ getErrorKey('email') | t }}
            </div>
        </label>

        <label>
            {{ 'register.password' | t }}
            <input class="input" type="password" formControlName="password" />
            <div *ngIf="getErrorKey('password')" class="error-popup">
                {{ getErrorKey('password') | t:{ min: 8 } }}
            </div>
        </label>

        <label>
            <input type="checkbox" formControlName="consent_given" />
            {{ 'register.consent' | t }}
            <div *ngIf="getErrorKey('consent_given')" class="error-popup">
                {{ getErrorKey('consent_given') | t }}
            </div>
        </label>
    </div>

    <!-- Boutons -->
    <div class="buttons">
        <button *ngIf="step > 1" type="button" (click)="prevStep()">
            {{ 'common.prev' | t }}
        </button>
        <button *ngIf="step < maxSteps" type="button" (click)="nextStep()">
            {{ 'common.next' | t }}
        </button>
        <button *ngIf="step === maxSteps" type="submit">
            {{ 'common.submit' | t }}
        </button>
    </div>

</form>

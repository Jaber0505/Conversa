<shared-multi-select
  [placeholder]="'Langues cibles'"
  [options]="langOptions()"
  [value]="selectedLangCodes()"
  (valueChange)="onCodesChange($event)">
</shared-multi-select>
<shared-button (click)="search()">
  {{ 'common.search' | t }}
</shared-button>

<div class="mt-2">
  Codes sélectionnés: {{ selectedLangCodes() | json }}
</div>
<shared-container>
  <shared-headline-bar
    [title]="'events.title' | t">
  </shared-headline-bar>
  <div class="state error" *ngIf="error() as err">
    <shared-badge variant="danger" tone="soft">{{ err }}</shared-badge>
  </div>

  <ng-container >
    <div class="state empty" *ngIf="events().length === 0">
      <shared-badge variant="muted" tone="soft">{{ 'events.empty' | t }}</shared-badge>
    </div>

    <shared-grid class="events-grid" *ngIf="events().length > 0">
      <shared-card *ngFor="let ev of events(); trackBy: trackById">

        <div media class="thumb" aria-hidden="true"></div>

        <div header class="ev-head">
          <h3 class="h6">{{ ev.title }}</h3>
          <div class="badges">
            <shared-badge variant="accent" tone="soft">{{ ev.language_code }}</shared-badge>
            <shared-badge variant="muted"  tone="soft">{{ ev.city }}</shared-badge>
            <shared-badge variant="danger" tone="soft" *ngIf="ev.is_cancelled">
              {{ 'events.cancelled' | t }}
            </shared-badge>
          </div>
        </div>

        <div class="ev-body">
          <div class="row">
            <span class="label">{{ 'events.language' | t }}</span>
            <span class="value">{{ ev.language_code }}</span>
          </div>
          <div class="row">
            <span class="label">{{ 'events.address' | t }}</span>
            <span class="value">{{ ev.address }}</span>
          </div>
          <div class="row">
            <span class="label">{{ 'events.when' | t }}</span>
            <span class="value">{{ ev.datetime_start | date:'EEEE d MMM, HH:mm' }}</span>
          </div>
          <div class="row">
            <span class="label">{{ 'events.theme' | t }}</span>
            <span class="value">{{ ev.theme }}</span>
          </div>
        </div>

        <div footer class="ev-foot">
          <div class="price">
            {{ ev.price_cents === 0 ? ('events.free' | t) : price(ev) }}
          </div>
            <shared-button type="button" [disabled]="ev.is_cancelled" (click)="goTo(ev.id)" *ngIf="!ev.alreadyBooked">
              {{ ev.is_cancelled ? ('events.cancelled' | t) : ('events.book' | t) }}
            </shared-button>
            <span class="booked-info">
    <shared-badge tone="soft" variant="accent" *ngIf="ev.alreadyBooked">{{ 'events.already_booked' | t }}</shared-badge>
  </span>
        </div>
        <app-confirm-purchase *ngIf="confirmPopup"
                              [titleKey]="'checkout.title'"
                              [messageKey]="'checkout.message'"
                              [buyKey]="'checkout.buy'"
                              [cancelKey]="'common.cancel'"
                              [priceCents]="ev.price_cents"
                              [asModal]="true"
                              (cancel)="closeDialog()"
                              (buy)="performPurchase()">
        </app-confirm-purchase>
      </shared-card>
    </shared-grid>
  </ng-container>
</shared-container>
